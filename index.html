{% extends "base.html" %}

{% block content %}
<div class="container my-5">

    <!-- Protect Code Card -->
    <div class="card shadow-lg border-0 rounded-3">
        <div class="card-body">
            <h2 class="mb-4">ğŸ”’ Protect Your Code</h2>
            <form id="protectForm">
                <div class="mb-3">
                    <label class="form-label fw-bold">Paste your code below:</label>
                    <textarea id="codeInput" class="form-control" rows="8" placeholder="Enter your code here..." required></textarea>
                </div>

                <div class="form-check mb-3">
                    <input type="checkbox" id="showIps" class="form-check-input">
                    <label for="showIps" class="form-check-label">
                        Enable IP logging and monitoring <span class="text-muted">(recommended)</span>
                    </label>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        ğŸ›¡ï¸ Protect Code
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="obfuscateCode()">
                        ğŸ”€ Obfuscate Only
                    </button>
                </div>
            </form>

            <!-- Protect Result -->
            <div id="result" class="alert alert-success mt-4 d-none">
                <h5 class="mb-3">âœ… Code Protected Successfully!</h5>

                <div class="input-group mb-3">
                    <span class="input-group-text">Protected URL</span>
                    <input type="url" id="protectedUrl" class="form-control" readonly>
                    <button class="btn btn-outline-secondary" type="button"
                        onclick="copyToClipboard(document.getElementById('protectedUrl').value)">ğŸ“‹ Copy</button>
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">Loadstring URL</span>
                    <input type="text" id="loadstringUrl" class="form-control" readonly>
                    <button class="btn btn-outline-secondary" type="button" onclick="copyLoadstring()">ğŸ“‹ Copy</button>
                </div>

                <p class="mb-1"><strong>Save these URLs!</strong> Only you (from this IP) can edit/delete the code.</p>
                <small class="text-muted">ğŸ”’ The loadstring URL includes extra IP protection and monitoring.</small>
            </div>

            <!-- Obfuscate Result -->
            <div id="obfuscatedResult" class="alert alert-info mt-4 d-none">
                <h5 class="mb-3">ğŸ”€ Code Obfuscated!</h5>
                <textarea id="obfuscatedCode" class="form-control mb-2" rows="6" readonly></textarea>
                <button class="btn btn-outline-secondary"
                    onclick="copyToClipboard(document.getElementById('obfuscatedCode').value)">ğŸ“‹ Copy Obfuscated Code</button>
            </div>
        </div>
    </div>

    <!-- Features Card -->
    <div class="card shadow-sm border-0 rounded-3 mt-4">
        <div class="card-body">
            <h2 class="mb-3">ğŸ“Š Features</h2>
            <ul class="list-unstyled mb-0">
                <li>ğŸ”’ <strong>Code Protection:</strong> Generate secure links for your code</li>
                <li>âš ï¸ <strong>Access Warnings:</strong> Non-owners see warning messages</li>
                <li>ğŸ”€ <strong>Code Obfuscation:</strong> Make your code unreadable</li>
                <li>ğŸ“Š <strong>Access Logging:</strong> Track who tries to view your code</li>
                <li>âœï¸ <strong>Owner Controls:</strong> Edit, delete, and manage your protected code</li>
                <li>ğŸŒ <strong>IP-based Authentication:</strong> Automatic owner recognition</li>
            </ul>
        </div>
    </div>
</div>

<script>
document.getElementById('protectForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const code = document.getElementById('codeInput').value;
    if (!code.trim()) {
        alert('Please enter some code to protect!');
        return;
    }
    
    const formData = new FormData();
    formData.append('code', code);
    
    fetch('/protect', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('protectedUrl').value = data.protected_url;
            document.getElementById('loadstringUrl').value = data.loadstring_url;
            document.getElementById('result').classList.remove('d-none');
            document.getElementById('obfuscatedResult').classList.add('d-none');
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        alert('Error protecting code: ' + error);
    });
});

function obfuscateCode() {
    const code = document.getElementById('codeInput').value;
    if (!code.trim()) {
        alert('Please enter some code to obfuscate!');
        return;
    }
    
    const formData = new FormData();
    formData.append('code', code);
    formData.append('show_ips', document.getElementById('showIps').checked);
    
    fetch('/obfuscate', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.obfuscated_code) {
            document.getElementById('obfuscatedCode').value = data.obfuscated_code;
            document.getElementById('obfuscatedResult').classList.remove('d-none');
            document.getElementById('result').classList.add('d-none');
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        alert('Error obfuscating code: ' + error);
    });
}

function copyLoadstring() {
    const url = document.getElementById('loadstringUrl').value;
    const loadstring = `loadstring(game:HttpGet('${url}'))()`;
    copyToClipboard(loadstring);
}
</script>
{% endblock %}
